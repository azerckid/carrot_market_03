# 단계별 구현 가이드 및 테스트 체크리스트

## 📋 전체 단계 개요

이 가이드는 **6개의 단계**로 나뉘어져 있으며, 각 단계마다:
1. 구현 내용
2. 테스트 체크리스트
3. 커밋 메시지 제안
4. 다음 단계 안내

가 포함되어 있습니다.

---

## 🎯 진행 방식

1. 각 단계를 순서대로 구현합니다
2. 구현이 완료되면 **테스트 체크리스트**를 따라 직접 테스트합니다
3. 테스트가 모두 통과하면 **커밋 메시지**를 사용하여 커밋합니다
4. 커밋 완료 후 다음 단계로 진행합니다

---

# Step 1: 댓글 작성 Server Action 구현

## 📝 구현 내용

**목표**: 댓글을 데이터베이스에 저장하는 Server Action 생성

**파일 수정**:
- `app/posts/[id]/actions.ts` - `createComment` 함수 추가

**구현 사항**:
- 세션 확인 (로그인 체크)
- 입력 데이터 검증 (빈 댓글 체크)
- 데이터베이스에 댓글 저장
- 캐시 무효화 (`revalidatePath`)

---

## ✅ 테스트 체크리스트

### 1. 기본 기능 테스트
- [ ] **로그인 상태에서 댓글 작성**
  - 게시글 상세 페이지 접속
  - 댓글 작성 함수가 정상적으로 동작하는지 확인 (아직 UI는 없음)
  - 개발자 도구 콘솔에서 직접 함수 호출 테스트 가능

### 2. 에러 처리 테스트
- [ ] **로그인하지 않은 상태에서 댓글 작성 시도**
  - 로그아웃 상태에서 함수 호출
  - "로그인이 필요합니다" 에러 반환 확인

- [ ] **빈 댓글 작성 시도**
  - 빈 문자열 또는 공백만 있는 댓글 전송
  - "댓글 내용을 입력해주세요" 에러 반환 확인

### 3. 데이터베이스 확인
- [ ] **댓글이 정상적으로 저장되는지 확인**
  - 데이터베이스 파일 (`dev.db`) 확인 또는 Prisma Studio 사용
  - 댓글 데이터가 올바르게 저장되었는지 확인

### 4. 캐시 무효화 확인
- [ ] **댓글 작성 후 페이지 새로고침**
  - 댓글 작성 후 페이지 새로고침
  - 새로고침 없이도 댓글이 표시되는지 확인 (캐시 무효화 동작)

---

## 💾 커밋 메시지 제안

```
feat(posts): 댓글 작성 Server Action 구현

- createComment 함수 추가
- 세션 확인 및 입력 검증 로직 구현
- 댓글 데이터베이스 저장 기능 추가
- revalidatePath를 통한 캐시 무효화 처리
```

---

## ➡️ 다음 단계

테스트가 모두 통과하고 커밋이 완료되면 → **Step 2**로 진행

---

# Step 2: 댓글 리스트 표시

## 📝 구현 내용

**목표**: 게시글 상세 페이지에 댓글 리스트 표시

**파일 수정**:
- `app/posts/[id]/page.tsx` - `getPost` 함수 수정, 댓글 리스트 UI 추가

**구현 사항**:
- `getPost` 함수에서 댓글 데이터 포함 (`include`)
- 댓글 작성자 정보 (username, avatar) 포함
- 댓글 작성 시간 표시 (`formatToTimeAgo` 사용)
- 댓글 리스트 UI 컴포넌트 추가

---

## ✅ 테스트 체크리스트

### 1. 댓글 리스트 표시 테스트
- [ ] **댓글이 있는 게시글 확인**
  - 댓글이 있는 게시글 상세 페이지 접속
  - 댓글 리스트가 정상적으로 표시되는지 확인
  - 댓글이 최신순으로 정렬되어 있는지 확인

- [ ] **댓글이 없는 게시글 확인**
  - 댓글이 없는 게시글 상세 페이지 접속
  - "댓글이 없습니다" 또는 빈 상태 메시지 표시 확인

### 2. 댓글 정보 표시 테스트
- [ ] **댓글 작성자 정보 표시**
  - 각 댓글에 작성자 아바타 이미지 표시 확인
  - 각 댓글에 작성자 이름 표시 확인

- [ ] **댓글 작성 시간 표시**
  - 각 댓글에 상대 시간 표시 확인 (예: "5분 전", "1시간 전")
  - `formatToTimeAgo` 함수가 정상 동작하는지 확인

- [ ] **댓글 내용 표시**
  - 댓글 내용이 정상적으로 표시되는지 확인
  - 긴 댓글이 잘 표시되는지 확인

### 3. UI/UX 테스트
- [ ] **레이아웃 확인**
  - 댓글 리스트가 게시글 하단에 적절히 배치되어 있는지 확인
  - 모바일 화면에서도 정상적으로 표시되는지 확인

- [ ] **스타일링 확인**
  - 댓글 아이템 간격이 적절한지 확인
  - 텍스트 색상 및 크기가 적절한지 확인

---

## 💾 커밋 메시지 제안

```
feat(posts): 게시글 상세 페이지에 댓글 리스트 표시

- getPost 함수에 댓글 데이터 포함하도록 수정
- 댓글 작성자 정보 및 작성 시간 표시
- 댓글 리스트 UI 컴포넌트 추가
- 최신순 정렬 적용
```

---

## ➡️ 다음 단계

테스트가 모두 통과하고 커밋이 완료되면 → **Step 3**로 진행

---

# Step 3: 댓글 작성 폼 추가

## 📝 구현 내용

**목표**: 댓글을 작성할 수 있는 입력 폼 추가

**파일 수정**:
- `app/posts/[id]/page.tsx` - 댓글 작성 폼 UI 추가

**구현 사항**:
- 댓글 입력 필드 (textarea 또는 input)
- 작성 버튼
- 로그인 상태 확인 (비로그인 시 폼 숨김 또는 안내 메시지)
- 폼 제출 핸들러 연결

---

## ✅ 테스트 체크리스트

### 1. 댓글 작성 폼 표시 테스트
- [ ] **로그인 상태에서 폼 표시**
  - 로그인한 상태에서 게시글 상세 페이지 접속
  - 댓글 작성 폼이 정상적으로 표시되는지 확인
  - 입력 필드와 작성 버튼이 모두 보이는지 확인

- [ ] **비로그인 상태에서 폼 처리**
  - 로그아웃 상태에서 게시글 상세 페이지 접속
  - 폼이 숨겨지거나 "로그인이 필요합니다" 메시지 표시 확인

### 2. 댓글 작성 기능 테스트
- [ ] **댓글 작성 성공**
  - 댓글 내용 입력
  - 작성 버튼 클릭
  - 댓글이 리스트에 추가되는지 확인
  - 입력 필드가 초기화되는지 확인

- [ ] **빈 댓글 작성 방지**
  - 빈 댓글 작성 시도
  - 에러 메시지 표시 또는 버튼 비활성화 확인

- [ ] **긴 댓글 작성**
  - 긴 텍스트 입력 테스트
  - 댓글이 정상적으로 저장되고 표시되는지 확인

### 3. UI/UX 테스트
- [ ] **폼 레이아웃**
  - 댓글 작성 폼이 댓글 리스트 상단 또는 하단에 적절히 배치되어 있는지 확인
  - 모바일 화면에서도 정상적으로 표시되는지 확인

- [ ] **로딩 상태**
  - 댓글 작성 중 로딩 상태 표시 확인 (선택사항)
  - 작성 버튼이 비활성화되는지 확인 (선택사항)

---

## 💾 커밋 메시지 제안

```
feat(posts): 댓글 작성 폼 추가

- 댓글 입력 필드 및 작성 버튼 추가
- 로그인 상태에 따른 폼 표시 처리
- 댓글 작성 핸들러 연결
- 입력 필드 초기화 기능 추가
```

---

## ➡️ 다음 단계

테스트가 모두 통과하고 커밋이 완료되면 → **Step 4**로 진행

---

# Step 4: 낙관적 업데이트 구현

## 📝 구현 내용

**목표**: 댓글 작성 시 즉시 UI에 반영되도록 낙관적 업데이트 구현

**파일 수정**:
- `app/posts/[id]/page.tsx` - `useOptimistic` 훅 사용

**구현 사항**:
- `useOptimistic` 훅으로 댓글 상태 관리
- 댓글 작성 즉시 임시 댓글을 리스트에 추가
- 서버 응답 후 실제 데이터로 교체
- 에러 발생 시 롤백 처리

---

## ✅ 테스트 체크리스트

### 1. 낙관적 업데이트 동작 테스트
- [ ] **즉시 UI 반영 확인**
  - 댓글 작성 버튼 클릭
  - 서버 응답 전에 댓글이 리스트에 즉시 표시되는지 확인
  - 작성 중인 댓글이 리스트 상단에 표시되는지 확인

- [ ] **서버 응답 후 데이터 교체**
  - 댓글 작성 후 잠시 대기
  - 임시 댓글이 실제 댓글로 교체되는지 확인
  - 실제 댓글 ID와 작성 시간이 올바르게 표시되는지 확인

### 2. 에러 처리 테스트
- [ ] **서버 에러 시 롤백**
  - 네트워크 오류 시뮬레이션 (개발자 도구에서 네트워크 차단)
  - 댓글 작성 시도
  - 임시 댓글이 제거되고 에러 메시지가 표시되는지 확인

- [ ] **중복 작성 방지**
  - 빠르게 여러 번 작성 버튼 클릭
  - 중복 댓글이 생성되지 않는지 확인

### 3. 사용자 경험 테스트
- [ ] **로딩 상태 표시**
  - 댓글 작성 중 로딩 인디케이터 표시 확인 (선택사항)
  - 작성 버튼 비활성화 확인 (선택사항)

- [ ] **입력 필드 초기화**
  - 댓글 작성 후 입력 필드가 즉시 초기화되는지 확인
  - 사용자가 연속으로 댓글을 작성할 수 있는지 확인

---

## 💾 커밋 메시지 제안

```
feat(posts): 댓글 작성 시 낙관적 업데이트 구현

- useOptimistic 훅을 사용한 낙관적 업데이트 적용
- 댓글 작성 즉시 UI에 반영되도록 개선
- 서버 응답 후 실제 데이터로 교체 처리
- 에러 발생 시 롤백 기능 추가
```

---

## ➡️ 다음 단계

테스트가 모두 통과하고 커밋이 완료되면 → **Step 5**로 진행

---

# Step 5: 게시글 CRUD 기능 구현

## 📝 구현 내용

**목표**: 게시글 추가, 수정, 삭제 기능 구현

**파일 생성/수정**:
- `app/posts/add/page.tsx` - 게시글 작성 페이지
- `app/posts/add/actions.ts` - 게시글 작성 Server Action
- `app/posts/edit/[id]/page.tsx` - 게시글 수정 페이지
- `app/posts/edit/[id]/actions.ts` - 게시글 수정 Server Action
- `app/posts/[id]/actions.ts` - 게시글 삭제 Server Action 추가
- `components/delete-post-button.tsx` - 삭제 버튼 컴포넌트
- `app/posts/[id]/page.tsx` - 삭제 버튼 추가

**구현 사항**:
- 게시글 작성 페이지 및 Server Action
- 게시글 수정 페이지 및 Server Action (소유자 확인)
- 게시글 삭제 Server Action (소유자 확인)
- 삭제 확인 모달
- 게시글 상세 페이지에 수정/삭제 버튼 추가 (소유자만 표시)

---

## ✅ 테스트 체크리스트

### 1. 게시글 추가 테스트
- [ ] **게시글 작성 페이지 접근**
  - `/posts/add` 경로로 접근 가능한지 확인
  - 뒤로가기 버튼이 정상 동작하는지 확인

- [ ] **게시글 작성 성공**
  - 제목과 설명 입력
  - 작성 완료 버튼 클릭
  - 게시글 상세 페이지로 리다이렉트되는지 확인
  - 작성한 게시글이 정상적으로 표시되는지 확인

- [ ] **게시글 작성 실패 (로그인 안 함)**
  - 로그아웃 상태에서 게시글 작성 시도
  - 에러 메시지 표시 또는 로그인 페이지로 리다이렉트 확인

- [ ] **입력 검증**
  - 제목 없이 작성 시도
  - 에러 메시지 표시 확인

### 2. 게시글 수정 테스트
- [ ] **게시글 수정 페이지 접근**
  - 본인이 작성한 게시글 상세 페이지에서 수정 버튼 클릭
  - `/posts/edit/[id]` 경로로 이동하는지 확인
  - 기존 제목과 설명이 폼에 표시되는지 확인

- [ ] **게시글 수정 성공**
  - 제목 또는 설명 수정
  - 저장 버튼 클릭
  - 게시글 상세 페이지로 리다이렉트되는지 확인
  - 수정된 내용이 정상적으로 표시되는지 확인

- [ ] **게시글 수정 실패 (권한 없음)**
  - 다른 사용자가 작성한 게시글 수정 시도
  - "수정 권한이 없습니다" 에러 메시지 확인
  - 또는 수정 버튼이 표시되지 않는지 확인

### 3. 게시글 삭제 테스트
- [ ] **게시글 삭제 버튼 표시**
  - 본인이 작성한 게시글 상세 페이지 접속
  - 삭제 버튼이 표시되는지 확인
  - 다른 사용자가 작성한 게시글에는 삭제 버튼이 보이지 않는지 확인

- [ ] **게시글 삭제 확인 모달**
  - 삭제 버튼 클릭
  - 확인 모달이 표시되는지 확인
  - 취소 버튼 클릭 시 모달이 닫히는지 확인

- [ ] **게시글 삭제 성공**
  - 확인 모달에서 확인 버튼 클릭
  - 게시글 리스트 페이지(`/life`)로 리다이렉트되는지 확인
  - 삭제된 게시글이 리스트에서 사라졌는지 확인

- [ ] **게시글 삭제 실패 (권한 없음)**
  - 다른 사용자가 작성한 게시글 삭제 시도
  - "삭제 권한이 없습니다" 에러 메시지 확인

- [ ] **게시글 삭제 시 댓글도 삭제되는지 확인**
  - 댓글이 있는 게시글 삭제
  - 데이터베이스에서 해당 게시글의 댓글도 함께 삭제되었는지 확인

### 4. 리스트 업데이트 테스트
- [ ] **게시글 추가 후 리스트 업데이트**
  - 게시글 작성 후 `/life` 페이지로 이동
  - 새로 작성한 게시글이 리스트에 표시되는지 확인

- [ ] **게시글 수정 후 리스트 업데이트**
  - 게시글 수정 후 `/life` 페이지로 이동
  - 수정된 제목이 리스트에 반영되는지 확인

- [ ] **게시글 삭제 후 리스트 업데이트**
  - 게시글 삭제 후 리스트 페이지 확인
  - 삭제된 게시글이 리스트에서 제거되었는지 확인

---

## 💾 커밋 메시지 제안

```
feat(posts): 게시글 CRUD 기능 구현

- 게시글 작성 페이지 및 Server Action 추가
- 게시글 수정 페이지 및 Server Action 추가
- 게시글 삭제 Server Action 및 버튼 컴포넌트 추가
- 소유자 확인 로직 구현
- 삭제 확인 모달 추가
- 게시글 상세 페이지에 수정/삭제 버튼 추가
```

---

## ➡️ 다음 단계

테스트가 모두 통과하고 커밋이 완료되면 → **Step 6**로 진행

---

# Step 6: 게시글 삭제 시 댓글 개수 확인 및 UI 개선

## 📝 구현 내용

**목표**: 게시글 삭제 시 댓글 개수를 확인하고 사용자에게 알림

**파일 수정**:
- `app/posts/[id]/actions.ts` - 댓글 개수 조회 로직 추가
- `components/delete-post-button.tsx` - 댓글 개수 표시
- `components/delete-confirm-modal.tsx` - 댓글 개수 메시지 추가 (또는 새 모달 생성)

**구현 사항**:
- 게시글 삭제 전 댓글 개수 조회
- 삭제 확인 모달에 댓글 개수 표시
- "이 게시글과 함께 X개의 댓글이 삭제됩니다" 메시지 추가

---

## ✅ 테스트 체크리스트

### 1. 댓글 개수 표시 테스트
- [ ] **댓글이 있는 게시글 삭제 시도**
  - 댓글이 있는 게시글에서 삭제 버튼 클릭
  - 확인 모달에 "이 게시글과 함께 X개의 댓글이 삭제됩니다" 메시지 표시 확인
  - 댓글 개수가 정확하게 표시되는지 확인

- [ ] **댓글이 없는 게시글 삭제 시도**
  - 댓글이 없는 게시글에서 삭제 버튼 클릭
  - 확인 모달에 댓글 관련 메시지가 표시되지 않거나 "댓글이 없습니다" 메시지 표시 확인

### 2. 삭제 동작 테스트
- [ ] **댓글이 있는 게시글 삭제 확인**
  - 댓글이 있는 게시글 삭제
  - 데이터베이스에서 게시글과 댓글이 모두 삭제되었는지 확인

- [ ] **댓글이 없는 게시글 삭제 확인**
  - 댓글이 없는 게시글 삭제
  - 게시글이 정상적으로 삭제되는지 확인

### 3. UI/UX 테스트
- [ ] **모달 메시지 가독성**
  - 삭제 확인 모달의 메시지가 명확하고 읽기 쉬운지 확인
  - 댓글 개수가 눈에 잘 띄는지 확인

- [ ] **모바일 화면 확인**
  - 모바일 화면에서도 모달이 정상적으로 표시되는지 확인
  - 메시지가 잘리지 않는지 확인

---

## 💾 커밋 메시지 제안

```
feat(posts): 게시글 삭제 시 댓글 개수 확인 기능 추가

- 게시글 삭제 전 댓글 개수 조회 로직 추가
- 삭제 확인 모달에 댓글 개수 표시
- 사용자에게 댓글 삭제 경고 메시지 추가
- 댓글이 없는 경우 메시지 처리 개선
```

---

## ➡️ 다음 단계

테스트가 모두 통과하고 커밋이 완료되면 → **모든 기능 구현 완료!** 🎉

---

# 🎉 완료 체크리스트

모든 단계가 완료되면 다음 사항을 최종 확인하세요:

## 최종 통합 테스트

### 댓글 기능
- [ ] 댓글 작성, 표시, 낙관적 업데이트 모두 정상 동작
- [ ] 여러 사용자가 같은 게시글에 댓글 작성 가능
- [ ] 댓글 작성자 정보가 정확히 표시됨

### 게시글 CRUD
- [ ] 게시글 추가, 수정, 삭제 모두 정상 동작
- [ ] 권한 확인이 정확히 작동함 (본인만 수정/삭제 가능)
- [ ] 게시글 삭제 시 댓글도 함께 삭제됨

### 리스트 업데이트
- [ ] 게시글 추가/수정/삭제 후 리스트가 자동으로 업데이트됨
- [ ] 캐시 무효화가 정상적으로 작동함

### UI/UX
- [ ] 모든 페이지가 모바일에서도 정상적으로 표시됨
- [ ] 에러 메시지가 명확하게 표시됨
- [ ] 로딩 상태가 적절히 표시됨 (선택사항)

---

# 📚 참고 자료

## 주요 파일 경로
- 게시글 상세: `app/posts/[id]/page.tsx`
- 댓글 액션: `app/posts/[id]/actions.ts`
- 게시글 작성: `app/posts/add/page.tsx`
- 게시글 수정: `app/posts/edit/[id]/page.tsx`
- 게시글 리스트: `app/(tabs)/life/page.tsx`

## 참고할 기존 패턴
- `app/product/add/` - 게시글 추가 패턴
- `app/product/edit/[id]/` - 게시글 수정 패턴
- `components/like-button.tsx` - 낙관적 업데이트 패턴
- `components/delete-product-button.tsx` - 삭제 버튼 패턴

---

**작성일**: 2024-12-10
**프로젝트**: Carrot Market - 게시글 및 댓글 기능

