# μ ν’ μƒμ„Έ νμ΄μ§€ λ΅λ”© λ¬Έμ  μ›μΈ λ¶„μ„

## π” λ¬Έμ  ν„μƒ

- μ ν’μ„ μ„ νƒν•λ©΄ ν™”λ©΄μ— μ ν’ μ†κ°κ°€ λ‚μ¤μ§€ μ•μ
- ν™”λ©΄μ„ λ¦¬λ΅λ”©ν•λ©΄ μ •μƒμ μΌλ΅ ν‘μ‹λ¨

## π“‹ μ›μΈ λ¶„μ„

### ν•µμ‹¬ λ¬Έμ : `unstable_cache`μ μΊμ‹ ν‚¤ λ¶μΌμΉ

**μ„μΉ**: `app/products/[id]/page.tsx` 112λ² μ¤„

```typescript
const getCachedProduct = nextCache(getProduct, ["product-detail"], {
  tags: ["product-detail"],
});
```

### λ¬Έμ μ 

1. **μΊμ‹ ν‚¤μ— `productId`κ°€ ν¬ν•¨λμ§€ μ•μ**
   - ν„μ¬ μΊμ‹ ν‚¤: `["product-detail"]` (λ¨λ“  μ ν’μ— λ€ν•΄ λ™μΌ)
   - `getProduct(id)` ν•¨μλ” λ™μ  νλΌλ―Έν„° `id`λ¥Ό λ°›μ§€λ§, μΊμ‹ ν‚¤λ” μ •μ μΌλ΅ κ³ μ •λ¨

2. **λ™μ‘ κ³Όμ •**
   ```
   1. μ ν’ ID: 1 μ΅°ν
      β†’ getCachedProduct(1) νΈμ¶
      β†’ μΊμ‹ ν‚¤: ["product-detail"]
      β†’ ID: 1 λ°μ΄ν„°κ°€ μΊμ‹μ— μ €μ¥λ¨
   
   2. μ ν’ ID: 22 ν΄λ¦­ (ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ λ„¤λΉ„κ²μ΄μ…)
      β†’ getCachedProduct(22) νΈμ¶
      β†’ μΊμ‹ ν‚¤: ["product-detail"] (λ™μΌ!)
      β†’ β μΊμ‹μ—μ„ ID: 1 λ°μ΄ν„°κ°€ λ°ν™λ¨ (μλ»λ λ°μ΄ν„°!)
   
   3. ν™”λ©΄ λ¦¬λ΅λ”© (μ „μ²΄ μƒλ΅κ³ μΉ¨)
      β†’ μ„λ²„μ—μ„ μƒλ΅μ΄ μ”μ²­ μ²λ¦¬
      β†’ getProduct(22)κ°€ μ‹¤ν–‰λμ–΄ μ¬λ°”λ¥Έ λ°μ΄ν„° λ°ν™
   ```

### μ™ μ΄λ° μΌμ΄ λ°μƒν•λ”κ°€?

Next.jsμ `unstable_cache`λ” λ‹¤μκ³Ό κ°™μ΄ λ™μ‘ν•©λ‹λ‹¤:

```typescript
unstable_cache(fn, keyParts, options)
```

- `fn`: μΊμ‹±ν•  ν•¨μ
- `keyParts`: **μ •μ  μΊμ‹ ν‚¤ λ°°μ—΄** (λ°νƒ€μ„ κ°’ λ¶κ°€)
- `options`: μΊμ‹ μµμ… (tags, revalidate λ“±)

**λ¬Έμ **: `getProduct(id)`μ `id` νλΌλ―Έν„°λ” λ™μ μ΄μ§€λ§, μΊμ‹ ν‚¤ `["product-detail"]`μ€ μ •μ μ…λ‹λ‹¤.

κ²°κ³Όμ μΌλ΅:
- `getCachedProduct(1)`κ³Ό `getCachedProduct(22)`κ°€ **κ°™μ€ μΊμ‹ ν‚¤**λ¥Ό μ‚¬μ©
- μ²« λ²μ§Έλ΅ μ΅°νν• μ ν’μ λ°μ΄ν„°κ°€ κ³„μ† λ°ν™λ¨
- ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ λ„¤λΉ„κ²μ΄μ… μ‹ Next.js λΌμ°ν„° μΊμ‹κ°€ μ΄ μλ»λ μΊμ‹λ¥Ό μ¬μ‚¬μ©

### ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ λ„¤λΉ„κ²μ΄μ… vs μ „μ²΄ λ¦¬λ΅λ”©

#### ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ λ„¤λΉ„κ²μ΄μ… (λ¬Έμ  λ°μƒ)
- Next.js App Routerμ ν΄λΌμ΄μ–ΈνΈ λΌμ°ν„°κ°€ μΊμ‹λ λ°μ΄ν„°λ¥Ό μ¬μ‚¬μ©
- `unstable_cache`μ μλ»λ μΊμ‹ ν‚¤λ΅ μΈν•΄ μ΄μ „ μ ν’ λ°μ΄ν„°κ°€ λ°ν™λ¨

#### μ „μ²΄ λ¦¬λ΅λ”© (μ •μƒ μ‘λ™)
- μ„λ²„μ—μ„ μƒλ΅μ΄ μ”μ²­μ„ μ²λ¦¬
- μΊμ‹λ¥Ό μ°νν•κ±°λ‚ μ¬λ°”λ¥Έ λ°μ΄ν„°λ¥Ό μ΅°νν•¨

## π”§ ν•΄κ²° λ°©λ²• (μ°Έκ³  - μμ •ν•μ§€ μ•μ)

`unstable_cache`λ¥Ό μ¬λ°”λ¥΄κ² μ‚¬μ©ν•λ ¤λ©΄:

1. **μµμ… 1: μΊμ‹ ν‚¤μ— `id` ν¬ν•¨** (κ¶μ¥ν•μ§€ μ•μ - `unstable_cache`λ” μ •μ  ν‚¤λ§ μ§€μ›)
   - `unstable_cache`λ” λ™μ  νλΌλ―Έν„°λ¥Ό μΊμ‹ ν‚¤μ— ν¬ν•¨ν•  μ μ—†μ

2. **μµμ… 2: ν•¨μ λ‚΄λ¶€μ—μ„ μΊμ‹ ν‚¤ μƒμ„±**
   ```typescript
   async function getProduct(id: number) {
     // ν•¨μ λ‚΄λ¶€μ—μ„ μ§μ ‘ μΊμ‹ μ²λ¦¬
     return await db.query.products.findFirst({...});
   }
   const getCachedProduct = nextCache(
     getProduct, 
     ["product-detail", id.toString()], // β μ΄κ²ƒλ„ μ‘λ™ν•μ§€ μ•μ (idλ” λ°νƒ€μ„ κ°’)
     { tags: ["product-detail"] }
   );
   ```

3. **μµμ… 3: `unstable_cache` λ€μ‹  λ‹¤λ¥Έ λ°©λ²• μ‚¬μ©** (κ¶μ¥)
   - `unstable_cache`λ¥Ό μ κ±°ν•κ³  μ§μ ‘ μΏΌλ¦¬ μ‹¤ν–‰
   - λλ” λ™μ  λΌμ°νΈμ—μ„λ” `unstable_cache` μ‚¬μ©μ„ μ§€μ–‘

## π“ μν–¥ λ²”μ„

- **μν–¥λ°›λ” κΈ°λ¥**: μ ν’ μƒμ„Έ νμ΄μ§€ (`/products/[id]`)
- **μν–¥λ°›λ” μ‚¬μ©μ**: ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ λ„¤λΉ„κ²μ΄μ… μ‚¬μ© μ‹
- **μν–¥λ°›μ§€ μ•λ” κ²½μ°**: μ „μ²΄ νμ΄μ§€ λ¦¬λ΅λ”©, μ§μ ‘ URL μ ‘κ·Ό

## π“ μ°Έκ³ μ‚¬ν•­

- Next.jsμ `unstable_cache`λ” μ •μ  μΊμ‹ ν‚¤λ§ μ§€μ›ν•©λ‹λ‹¤
- λ™μ  λΌμ°νΈ(`[id]`)μ—μ„λ” `unstable_cache` μ‚¬μ© μ‹ μ£Όμκ°€ ν•„μ”ν•©λ‹λ‹¤
- `revalidateTag`λ¥Ό μ‚¬μ©ν• μΊμ‹ λ¬΄ν¨ν™”λ” μ‘λ™ν•μ§€λ§, μΊμ‹ ν‚¤ λ¶μΌμΉ λ¬Έμ λ¥Ό ν•΄κ²°ν•μ§€ λ»ν•©λ‹λ‹¤
